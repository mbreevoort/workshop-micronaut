<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="JDriven">
<title>Micronaut workshop</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Micronaut workshop</h1>
<div class="details">
<span id="author" class="author">JDriven</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_software_requirements">Software requirements</a></li>
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_who_makes_micronaut">Who makes Micronaut</a></li>
<li><a href="#_reactive_microservices">Reactive microservices</a></li>
<li><a href="#_tries_to_be">Tries to be</a></li>
<li><a href="#_dependency_injection">Dependency Injection</a></li>
<li><a href="#_http_server">HTTP Server</a></li>
<li><a href="#_controller">Controller</a></li>
<li><a href="#_request_binding">Request binding</a></li>
<li><a href="#_reactive_responses">Reactive responses</a></li>
<li><a href="#_non_reactive_responses">Non-reactive responses</a></li>
<li><a href="#_http_client">HTTP Client</a></li>
<li><a href="#_testing">Testing</a></li>
<li><a href="#_cloud_native_features">Cloud native features</a></li>
<li><a href="#_serverless">Serverless</a></li>
<li><a href="#_message_driven_microservices">Message driven microservices</a></li>
<li><a href="#_command_line_applications">Command line applications</a></li>
<li><a href="#_micronaut_for_spring">Micronaut for Spring</a></li>
<li><a href="#_configurations">Configurations</a></li>
</ul>
</li>
<li><a href="#_resources">Resources</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
<li><a href="#_install_micronaut_cli">Install Micronaut CLI</a>
<ul class="sectlevel2">
<li><a href="#_using_sdkman_linux_macos_cygwin">Using SDKMAN! (Linux, MacOS, Cygwin)</a></li>
<li><a href="#_download_zip_file_windows">Download ZIP file (Windows)</a></li>
</ul>
</li>
<li><a href="#_using_cli">Using CLI</a></li>
<li><a href="#_using_launch">Using Launch</a></li>
<li><a href="#_server_application">Server application</a>
<ul class="sectlevel2">
<li><a href="#_to_be_reactive_or_not_to_be_reactive">To be reactive or not to be reactive?</a></li>
<li><a href="#_json">JSON</a></li>
<li><a href="#_url_path_variables">URL path variables</a></li>
<li><a href="#_server_sent_events">Server-sent events</a></li>
</ul>
</li>
<li><a href="#_dependency_injection_2">Dependency injection</a></li>
<li><a href="#_testing_2">Testing</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_use_configuration_values">Use configuration values</a></li>
</ul>
</li>
<li><a href="#_http_client_2">HTTP Client</a>
<ul class="sectlevel2">
<li><a href="#_low_level_client">Low-level client</a></li>
<li><a href="#_declarative_client">Declarative client</a></li>
</ul>
</li>
<li><a href="#_database">Database</a>
<ul class="sectlevel2">
<li><a href="#_mongo_repository">Mongo repository</a></li>
<li><a href="#_conferences_api">Conferences API</a></li>
</ul>
</li>
<li><a href="#_monitoring">Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_health">Health</a></li>
<li><a href="#_info">Info</a></li>
</ul>
</li>
<li><a href="#_service_discovery">Service discovery</a>
<ul class="sectlevel2">
<li><a href="#_consul">Consul</a></li>
<li><a href="#_conference_service">Conference service</a></li>
<li><a href="#_gateway">Gateway</a></li>
<li><a href="#_retry">Retry</a></li>
<li><a href="#_fallback">Fallback</a></li>
</ul>
</li>
<li><a href="#_serverless_functions">Serverless functions</a></li>
<li><a href="#_graalvm_support">GraalVM support</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_software_requirements">Software requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need the following software for the workshop:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 8+</p>
</li>
<li>
<p>Docker, with the following images</p>
<div class="ulist">
<ul>
<li>
<p><code>mongo</code></p>
</li>
<li>
<p><code>consul</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We start with a small introduction based on a presentation about Micronaut.
To skip the introduction and start directly with the workshop we can go to <a href="#_install_micronaut_cli">Install Micronaut CLI</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut is a JVM framework for building scalable, performant applications using <strong>Java</strong>, <strong>Groovy</strong> or <strong>Kotlin</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An efficient compile-time dependency-injection container</p>
</li>
<li>
<p>A reactive HTTP server &amp; client based on Netty</p>
</li>
<li>
<p>A suite of cloud-native features to boost developer productivity when building microservice systems.</p>
</li>
<li>
<p>Apache License v2</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_who_makes_micronaut">Who makes Micronaut</h3>
<div class="ulist">
<ul>
<li>
<p>From creators of Grails</p>
</li>
<li>
<p>Open source</p>
</li>
<li>
<p>Developers paid by OCI</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reactive_microservices">Reactive microservices</h3>
<div class="ulist">
<ul>
<li>
<p>Any Reactive Streams implementation:</p>
<div class="ulist">
<ul>
<li>
<p>RxJava 2.x</p>
</li>
<li>
<p>Reactor 3.x</p>
</li>
</ul>
</div>
</li>
<li>
<p>Plain old <code>java.util.concurrent.CompletableFuture</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tries_to_be">Tries to be</h3>
<div class="ulist">
<ul>
<li>
<p>Small in heap size</p>
</li>
<li>
<p>Fast in startup</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_injection">Dependency Injection</h3>
<div class="ulist">
<ul>
<li>
<p>Compile-time: no reflection, no runtime proxies</p>
</li>
<li>
<p>JSR-330 (<code>javax.inject</code>) or Spring-like</p>
</li>
<li>
<p>Annotation processors for Java</p>
</li>
<li>
<p>AST transformations for Groovy</p>
</li>
<li>
<p>Conditional</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_http_server">HTTP Server</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package jdriven;

import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controller">Controller</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package jdriven;

import io.reactivex.Single;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello")
public class HelloController {

    @Get(value = "/", produces = MediaType.TEXT_PLAIN)
    public Single&lt;String&gt; index() {
        return Single.just("Hello JDriven!");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_request_binding">Request binding</h3>
<div class="ulist">
<ul>
<li>
<p>Body</p>
</li>
<li>
<p>Cookies</p>
</li>
<li>
<p>Headers</p>
</li>
<li>
<p>Parameters</p>
</li>
<li>
<p>Path variables</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reactive_responses">Reactive responses</h3>
<div class="ulist">
<ul>
<li>
<p>Type that implements <code>org.reactivestreams.Publisher</code></p>
</li>
<li>
<p>A <code>CompletableFuture</code> instance</p>
</li>
<li>
<p>An <code>io.micronaut.http.HttpResponse</code> instance wrapping reactive type</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_non_reactive_responses">Non-reactive responses</h3>
<div class="ulist">
<ul>
<li>
<p>Any implementation of <code>CharSequence</code></p>
</li>
<li>
<p>POJO</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_http_client">HTTP Client</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package jdriven;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.Client;
import io.reactivex.Single;

@Client("/hello")
public interface HelloClient {

    @Get("/")
    Single&lt;String&gt; hello();

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package jdriven;

import io.micronaut.context.ApplicationContext;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;

import org.junit.jupiter.api.Test;

import javax.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerTest {

    @Inject
    EmbeddedServer embeddedServer;

    @Test
    public void testHello() {
        try(RxHttpClient client = embeddedServer.getApplicationContext().createBean(RxHttpClient.class, embeddedServer.getURL())) {
            assertEquals("Hello JDriven!", client.hello().blockingGet());
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_native_features">Cloud native features</h3>
<div class="ulist">
<ul>
<li>
<p>Distributed configuration: Consul, AWS Parameter Store</p>
</li>
<li>
<p>Service discovery: Consul, Eureka, Kubernetes, AWS Route 53</p>
</li>
<li>
<p>Client-side load balancing, optional Netflix Ribbon</p>
</li>
<li>
<p>Fault tolerant: retry, fallback, circuit breaker, Hystrix support</p>
</li>
<li>
<p>Distributed tracing: Zipkin, Jaeger</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_serverless">Serverless</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package jdriven;

import io.micronaut.function.FunctionBean;
import java.util.function.Supplier;

@FunctionBean("hello-jdriven")
public class HelloJDrivenFunction implements Supplier&lt;String&gt; {

    @Override
    public String get() {
        return "Hello JDriven!";
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_message_driven_microservices">Message driven microservices</h3>
<div class="ulist">
<ul>
<li>
<p>Kafka producers</p>
</li>
<li>
<p>Kafka consumers</p>
</li>
<li>
<p>Kafka streams</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_applications">Command line applications</h3>
<div class="ulist">
<ul>
<li>
<p>Based on Picocli</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_for_spring">Micronaut for Spring</h3>
<div class="ulist">
<ul>
<li>
<p>Run existing Spring Boot applications as Micronaut</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configurations">Configurations</h3>
<div class="ulist">
<ul>
<li>
<p>Datasources: Common DBCP, Hikari, Tomcat</p>
</li>
<li>
<p>Hibernate: JPA, GORM</p>
</li>
<li>
<p>Mongo</p>
</li>
<li>
<p>Neo4j</p>
</li>
<li>
<p>Postgres reactive</p>
</li>
<li>
<p>Redis</p>
</li>
<li>
<p>Cassandra</p>
</li>
<li>
<p>RabbitMQ</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The best resource is the <a href="https://docs.micronaut.io/latest/guide/index.html">documentation of Micronaut</a>.</p>
</li>
<li>
<p><a href="http://guides.micronaut.io">Micronaut guides</a></p>
</li>
<li>
<p><a href="http://micronaut.io/documentation.html">Micronaut documentation index</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-spring/latest/guide/index.html">Micronaut for Spring</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Developers using MacOS and experience long waiting times before a Micronaut application is started (from command-line, IDE or tests) should checkout <a href="https://docs.micronaut.io/latest/guide/index.html#problems">common problems</a> section in the Micronaut guide and then especially <em>It is taking much longer to start my application than it should (MacOS)</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_micronaut_cli">Install Micronaut CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started with a Micronaut application we can use the Micronaut Command-Line Interface (CLI).
With the CLI we can create the a project for a given language and build system, with necessary libraries.
To install the Micronaut CLI we can use <a href="http://sdkman.io">SDKMAN!</a> or download a ZIP file with all files.</p>
</div>
<div class="sect2">
<h3 id="_using_sdkman_linux_macos_cygwin">Using SDKMAN! (Linux, MacOS, Cygwin)</h3>
<div class="paragraph">
<p><a href="http://sdkman.io">SDKMAN!</a> is a tool for managing different versions of tools and Java.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First we need to install <a href="http://sdkman.io">SDKMAN!</a> if we don&#8217;t have it on our computer.</p>
</li>
<li>
<p>Next we can install Micronaut:</p>
<div class="listingblock">
<div class="content">
<pre>$ sdk install micronaut</pre>
</div>
</div>
</li>
<li>
<p>Now we can check if Micronaut is installed correctly:</p>
<div class="listingblock">
<div class="content">
<pre>$ mn --version
Micronaut Version: 3.1.3</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_download_zip_file_windows">Download ZIP file (Windows)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the <a href="https://github.com/micronaut-projects/micronaut-core/releases/download/v3.1.3/micronaut-3.1.3.zip">ZIP</a> file with Micronaut.</p>
</li>
<li>
<p>Next we need to extract the contents of the file to a directory on our computer.</p>
</li>
<li>
<p>We create a new environment variable <code>MICRONAUT_HOME</code> that points to the directory we unpacked the ZIP file in.</p>
</li>
<li>
<p>Next we change the <code>PATH</code> variable to include <code>%MICRONAUT_HOME%\bin</code>.</p>
</li>
<li>
<p>Finally, we can check if Micronaut is installed correctly:</p>
<div class="listingblock">
<div class="content">
<pre>$ mn --version
Micronaut Version: 3.1.3</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_cli">Using CLI</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micronaut CLI uses the file <code>settings.xml</code> in the <code>$USER/.m2</code> directory (if available) to download dependencies that are needed by the CLI. Please check that if a proxy is defined it can be reached, otherwise disable the proxy settings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CLI is used to create a new Micronaut project based on application types.
Micronaut has several application create commands, which are like project templates, for different kinds of applications.
To see which commands are available in Micronaut we can use the option <code>-h</code>.</p>
</div>
<div class="paragraph">
<p>First we start the interactive CLI with the command <code>mn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Next we can type the option <code>--help</code> to get an overview of all available create application commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mn&gt; --help
Usage: mn [-hvVx] [COMMAND]
Micronaut CLI command line interface for generating projects and services.
Application generation commands are:

*  create-app NAME
*  create-cli-app NAME
*  create-function-app NAME
*  create-grpc-app NAME
*  create-messaging-app NAME

Options:
  -h, --help         Show this help message and exit.
  -v, --verbose      Create verbose output.
  -V, --version      Print version information and exit.
  -x, --stacktrace   Show full stack trace when exceptions occur.

Commands:
  create-app            Creates an application
  create-cli-app        Creates a CLI application
  create-function-app   Creates a Cloud Function
  create-grpc-app       Creates a gRPC application
  create-messaging-app  Creates a messaging application</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The interactive CLI also has command completion when we use the <kbd>Tab</kbd> character.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>create-app</em> command for example is used to create a REST server with client.
Each application type also has dependencies wich are bundled into features.
To see which features are availble for a create command we use the option <code>--list-features</code> after the create command.</p>
</div>
<div class="paragraph">
<p>To see all features for the <em>create-app</em> command we type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mn&gt; create-app --list-features
Available Features
(+) denotes the feature is included by default
  Name                                                    Description
  ------------------------------------------------------  ---------------
  API
  graphql                                                 Adds support for GraphQL
  openapi                                                 Adds support for OpenAPI (Swagger)

  BPM
  camunda                                                 Integrate Camunda Workflow Engine
  camunda-external-worker                                 Implement Camunda External Workers

  CI/CD
  github-workflow-azure-container-instance [PREVIEW]      Adds a GitHub Actions Workflow to deploy to Azure Container Instance
  github-workflow-azure-container-instance-graalvm [PREVIEW]Adds a GitHub Actions Workflow to deploy a GraalVM native image to Azure Container Instance
  github-workflow-docker-registry [PREVIEW]               Adds a GitHub Actions Workflow to build and push a Docker image to any Docker registry
  github-workflow-google-cloud-run [PREVIEW]              Adds a GitHub Actions Workflow to deploy to Google Cloud Run from Google Container Registry
  github-workflow-google-cloud-run-graalvm [PREVIEW]      Adds a GitHub Actions Workflow to deploy a GraalVM native image to Google Cloud Run from Google Container Registry
  github-workflow-graal-docker-registry [PREVIEW]         Adds a GitHub Actions Workflow to build and push a GraalVM native image to a Docker registry
  github-workflow-oracle-cloud-functions [PREVIEW]        Adds a GitHub Actions Workflow to deploy to Oracle Functions from Oracle Cloud Infrastructure Registry
  github-workflow-oracle-cloud-functions-graalvm [PREVIEW]Adds a GitHub Actions Workflow to deploy a GraalVM native image to Oracle Functions from Oracle Cloud Infrastructure Registry

  Cache
  cache-caffeine                                          Adds support for caching using Caffeine
  cache-coherence                                         Adds support for caching using Coherence
  cache-ehcache                                           Adds support for caching using EHCache
  cache-hazelcast                                         Adds support for caching using Hazelcast
  cache-infinispan                                        Adds support for caching using Infinispan

  Client
  coherence-session                                       Adds support for storing HTTP sessions in Coherence
  http-client (+)                                         Adds support for the Micronaut HTTP client
  http-session                                            Adds support for HTTP Sessions
  netflix-ribbon                                          Adds support for client side load balancing using Netflix Ribbon

  Cloud
  aws-v2-sdk                                              Provides integration with the AWS SDK 2.x
  dekorate-halkyon [PREVIEW]                              Extends Decorate's generated Kubernetes deployment manifests with Halkyon resources using Dekorate Halkyon Support
  dekorate-jaeger [PREVIEW]                               Adds to Decorate deployment manifests Jaeger sidecar container
  dekorate-knative [PREVIEW]                              Generates Knative Kubernetes deployment manifest using Dekorate Knative Support
  dekorate-kubernetes [PREVIEW]                           Generates Kubernetes deployment manifest using Dekorate Kubernetes Support
  dekorate-openshift [PREVIEW]                            Generates OpenShift deployment manifest using Dekorate OpenShift Support
  dekorate-prometheus [PREVIEW]                           Extends Decorate's generated Kubernetes deployment manifests with Prometheus ServiceMonitor resource using Dekorate Prometheus Support.
  dekorate-servicecatalog [PREVIEW]                       Extends Decorate's generated Kubernetes deployment manifests with Service Catalog resources using Dekorate Service Catalog Support
  knative                                                 Generates a Knative deployment descriptor for deployment to Kubernetes
  kubernetes                                              Generates a k8s deployment descriptor for deployment to Kubernetes
  oracle-cloud-atp                                        Provides integration with Oracle Cloud Autonomous Database
  oracle-cloud-sdk                                        Provides integration with the Oracle Cloud SDK
...</pre>
</div>
</div>
<div class="paragraph">
<p>Please browse through all features for the <em>create-app</em> command to see what is available.</p>
</div>
<div class="paragraph">
<p>To create command <em>create-app</em> has several other options.
We can see which options are available for a create command by using the <code>--help</code> options after the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mn&gt; create-app --help
Usage: mn create-app [-hivVx] [--list-features] [-b=BUILD-TOOL] [--jdk=&lt;javaVersion&gt;] [-l=LANG]
                     [-t=TEST] [-f=FEATURE[,FEATURE...]]... [NAME]
Creates an application
      [NAME]               The name of the application to create.
  -b, --build=BUILD-TOOL   Which build tool to configure. Possible values: gradle, gradle_kotlin,
                             maven.
  -f, --features=FEATURE[,FEATURE...]
                           The features to use. Possible values: jdbc-dbcp, jdbc-hikari,
                             jdbc-tomcat, jdbc-ucp, postgres, oracle-cloud-atp, jasync-sql,
                             data-jpa, knative, tracing-jaeger, elasticsearch,
                             micrometer-wavefront, jms-sqs, redis-lettuce, http-session,
                             micrometer-dynatrace, netflix-hystrix, views-handlebars, graalvm, jmx,
                             ktor, tomcat-server, micrometer-datadog, dekorate-kubernetes, rxjava2,
                             github-workflow-docker-registry, jackson-xml, liquibase, mysql,
                             micrometer-new-relic, sql-jdbi, dekorate-jaeger,
                             github-workflow-oracle-cloud-functions-graalvm, openapi,
                             dekorate-servicecatalog, rxjava1,
                             github-workflow-azure-container-instance, security,
                             coherence-grpc-client, spring-web, jax-rs, kubernetes, asciidoctor,
                             dekorate-prometheus, coherence-session, h2, azure-function,
                             security-ldap, r2dbc, oracle, aws-parameter-store, mongo-gorm,
                             spring-data-jdbc, spring, cassandra, graphql, views-pebble,
                             micrometer-prometheus, hibernate-gorm, micrometer-kairos,
                             jms-activemq-artemis, kafka, views-velocity, oracle-cloud-sdk,
                             micrometer-appoptics, jib, spring-data-jpa, mongo-sync,
                             micrometer-elastic, kafka-streams, micrometer-atlas, vertx-pg-client,
                             log4j2, gcp-pubsub, netflix-archaius, cache-caffeine,
                             cache-infinispan, aws-v2-sdk, dekorate-openshift, aws-secrets-manager,
                             aws-lambda-custom-runtime, micrometer-stackdriver, hibernate-jpa,
                             oracle-function, management, discovery-consul, problem-json,
                             jms-activemq-classic, netflix-ribbon, shade, slf4j-simple, neo4j-bolt,
                             jetty-server, github-workflow-graal-docker-registry, mqttv3,
                             camunda-external-worker, views-thymeleaf, views-soy,
                             micrometer-ganglia, coherence, mockito, google-cloud-function,
                             micrometer-influx, undertow-server, aws-lambda, neo4j-gorm, aws-alexa,
                             github-workflow-google-cloud-run, security-jwt, multi-tenancy,
                             micrometer-cloudwatch, cache-hazelcast, rss-itunes-podcast, camunda,
                             micrometer-statsd, github-workflow-azure-container-instance-graalvm,
                             spring-boot, micrometer-jmx, github-workflow-google-cloud-run-graalvm,
                             sqlserver, micrometer-signalfx, openrewrite, micrometer-azure-monitor,
                             mariadb, rxjava3, config-consul, jrebel, data-jdbc, mqtt, nats,
                             views-freemarker, micrometer-graphite, cache-ehcache,
                             github-workflow-oracle-cloud-functions, kotlin-extension-functions,
                             dekorate-knative, cache-coherence, gcp-cloud-trace,
                             vertx-mysql-client, flyway, jooq, dekorate-halkyon, assertj,
                             hibernate-validator, micrometer-humio, logback, multi-tenancy-gorm,
                             config-kubernetes, reactor, coherence-distributed-configuration,
                             coherence-data, rabbitmq, discovery-eureka, mongo-reactive,
                             testcontainers, data-r2dbc, acme, tracing-zipkin, netty-server,
                             http-client, views-rocker, hamcrest, lombok, springloaded, rss,
                             security-oauth2, security-session, config4k, properties
  -h, --help               Show this help message and exit.
  -i, --inplace            Create a service using the current directory
      --jdk, --java-version=&lt;javaVersion&gt;
                           The JDK version the project should target
  -l, --lang=LANG          Which language to use. Possible values: java, groovy, kotlin.
      --list-features      Output the available features and their descriptions
  -t, --test=TEST          Which test framework to use. Possible values: junit, spock, kotest.
  -v, --verbose            Create verbose output.
  -V, --version            Print version information and exit.
  -x, --stacktrace         Show full stack trace when exceptions occur.</pre>
</div>
</div>
<div class="paragraph">
<p>We can for example choose if we want to use Gradle (default) or Maven as build tool for our application using the <code>--build</code> option.
Once we have created the application the choosen build tool is used to build our Micronaut application.
This also means we can import the project into our IDE and use either Maven or Gradle to build the software.</p>
</div>
<div class="paragraph">
<p>We must also specify the profile using <code>--profile</code> and enable features with <code>--features</code>.</p>
</div>
<div class="paragraph">
<p>To leave the interactive shell we must type <code>exit</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_launch">Using Launch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using the command-line tool we can use the <a href="https://micronaut.io/launch">Micronaut Launch</a> website.
On the website we can select the features for our application, language and build tool.
By clicking on a button we can download a ZIP file with all project files or even create a Github project from our options.</p>
</div>
<div class="paragraph">
<p>This website functions similarly as the start.spring.io for Spring applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_application">Server application</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read <a href="https://docs.micronaut.io/latest/guide/index.html#httpServer">Micronaut: The HTTP Server</a> for more information on controllers, response status, JSON handling and more.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous section we learned about the Micronaut CLI and the <code>create-app</code> command.
Let&#8217;s create a new Micronaut application and learn about what we can do with Micronaut and how to develop an application.</p>
</div>
<div class="paragraph">
<p>We run the <code>create-app</code> command using the <code>mn</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app hello
| Generating Java project...
| Application created at /Projects/hello
$</pre>
</div>
</div>
<div class="paragraph">
<p>Or via the interactive shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt; create-app hello
| Application created at /Projects/hello
mn&gt; exit</pre>
</div>
</div>
<div class="paragraph">
<p>This will create a new directory <code>hello</code>.
When we go to the directory and check the contents we see a <code>build.gradle</code> file with the build description for our application.
In the directory <code>src/main/java</code> are our Java source files, a project structure we can recognize from the default Maven project structure.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default build tool is Gradle with Groovy syntax, but we can specify with the <code>--build</code> option the value <code>gradle_kotlin</code> to use Gradle as build tool, but with Kotlin as language for the build file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of using Gradle we can also choose to use Maven as build tool. A <code>pom.xml</code> is then generated instead of the <code>build.gradle</code> file. Use the option <code>--build=maven</code> for the <code>create-app</code> command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point we can open our project in our IDE, for example IntelliJ IDEA.
We need to import the project as a Java, Gradle or Maven project.
To create new Java class we can simply use our IDE, but we can also use the Micronaut CLI commands for specific classes.
The CLI command to create a new controller class is for example <code>create-controller</code>.
The command creates the correct Java class with a sample code and a corresponding test class.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When we use the IDE to compile the classes we must make sure annotation processor support is enabled. In IntelliJ IDEA we must go to <em>Settings | Build, Execution, Deployment | Compiler | Annotation Processors</em> and enable <em>Enable annotation processing</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Inside the <code>hello</code> directory we create a new controller <code>HelloController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-controller Hello
| Rendered controller to src/main/java/hello/HelloController.java
| Rendered test to src/test/java/hello/HelloControllerTest.java
$</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can create these classes also by hand if we know the correct syntax and don&#8217;t need the CLI.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated <code>HelloController</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Example Response";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Controller</code> annotation tells Micronaut the class is a REST controller in our application and the URL prefix used for accessing the endpoints in this class is <code>/hello</code>.
The <code>@Get</code> annotation on the <code>index</code> method is to tell Micronaut the method responds to a HTTP GET method.
Just like <code>@Get</code> we can use <code>@Post</code>, <code>@Delete</code>, <code>@Patch</code> and other annotations to support different HTTP methods.
The argument of the annotation is the endpoint for our controller and what a client for the REST API can access.
The default response type for requests in Micronaut is <code>application/json</code>, so in order to return another type, like we see in the generated controller, we use can set it via the <code>produces</code> argument.</p>
</div>
<div class="paragraph">
<p>It is time to run our application and see the output of our controller.
To start the application we must execute the <code>hello.Application</code> class that is part of our project.
We can choose to run it using our IDE or via the build tools Gradle or Maven.</p>
</div>
<div class="paragraph">
<p>In the following example we start the application using the Gradle build tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew run
...
&gt; Task :run
 __  __ _                                  _
|  \/  (_) ___ _ __ ___  _ __   __ _ _   _| |_
| |\/| | |/ __| '__/ _ \| '_ \ / _` | | | | __|
| |  | | | (__| | | (_) | | | | (_| | |_| | |_
|_|  |_|_|\___|_|  \___/|_| |_|\__,_|\__,_|\__|
  Micronaut (v3.1.3)

18:31:45.396 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 477ms. Server Running: http://localhost:8080
...</pre>
</div>
</div>
<div class="paragraph">
<p>The default port that the application uses is <code>8080</code>.</p>
</div>
<div class="paragraph">
<p>Using for example the tool <code>curl</code> we can access our application and see the output for <code>/hello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/hello
Example response
$</pre>
</div>
</div>
<div class="paragraph">
<p>Or we can open the URL in our browser as this is just a simple HTTP GET request.</p>
</div>
<div class="paragraph">
<p>To create a runnable JAR file we must invoke the Gradle <code>assemble</code> task.
This will create a JAR file in the directory <code>build/libs</code>, which we can start with <code>java -jar</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew assemble
$ java -jar build/libs/hello-0.1-all.jar
 __  __ _                                  _
|  \/  (_) ___ _ __ ___  _ __   __ _ _   _| |_
| |\/| | |/ __| '__/ _ \| '_ \ / _` | | | | __|
| |  | | | (__| | | (_) | | | | (_| | |_| | |_
|_|  |_|_|\___|_|  \___/|_| |_|\__,_|\__,_|\__|
  Micronaut (v{mn-version})

05:52:32.608 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 499ms. Server Running: http://localhost:8080</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Check the file size of the resulting JAR file. Because Micronaut&#8217;s core is not dependent on other big libraries, the total file size of the packaged application is relatively small (around 13MB).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_to_be_reactive_or_not_to_be_reactive">To be reactive or not to be reactive?</h3>
<div class="paragraph">
<p>Micronaut supports the Reactive Streams API through third party libraries, like Project Reactor and RxJava.
When we created our project we could have indicated which reactive library to use with the <code>--features</code> options, but we can also add the dependency ourselves in our build file.
Each method in a controller is handled on the same thread as the request thread of the underlying event loop of Netty.
This means our code executed by a controller method must not do any blocking I/O operations, like accessing a database using a JDBC driver or working with files on a file system.
In order to keep the event loop threads <em>clean</em> we must tell Micronaut to run the request on a fixed thread pool.
We will see later how we can achieve this.
We have to keep this in mind when we write applications in Micronaut.</p>
</div>
<div class="paragraph">
<p>As we use Gradle in our example we must add the following line to the <code>dependencies</code> section of our <code>build.gradle</code> file to Project Reactor as the reactive library in our application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>implementation("io.micronaut.reactor:micronaut-reactor:2.0.0")</pre>
</div>
</div>
<div class="paragraph">
<p>We change our <code>HelloController</code> and add an extra method with a reactive return type <code>Mono</code> and we change the original method to display the thread that is used to execute the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import reactor.core.publisher.Mono;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the application again and access both <code>/hello</code> and <code>/hello/reactive</code> and see the in the output which threads are used.
As expected both methods use threads from the event loop.
For our example we assume the methods will do some blocking I/O operations, so we want to tell Micronaut to use the fixed size thread pool, so the event loop threads will not be blocked.
We have 2 options for specifying the use of the fixed thread pool: using the <code>ExecuteOn</code> annotation or using the support of the reactive libraries to support a fixed thread pool.</p>
</div>
<div class="paragraph">
<p>We change our example to use both options, so we get an idea of how we can use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;
import jakarta.inject.Named;
import reactor.core.publisher.Mono;
import reactor.core.scheduler.Scheduler;
import reactor.core.scheduler.Schedulers;

import java.util.concurrent.ExecutorService;

@Controller("/hello")
public class HelloController {

    private final Scheduler scheduler;

    HelloController(@Named(TaskExecutors.IO) ExecutorService executorService) {
        scheduler = Schedulers.fromExecutorService(executorService);
    }

    @Get(uri="/", produces="text/plain")
    @ExecuteOn(TaskExecutors.IO)
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono
                .fromCallable(() -&gt;
                    "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName())
                .subscribeOn(scheduler);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Run <code>./gradlew run</code> with <code>--continuous</code> or <code>-t</code> to use Gradle&#8217;s continuous build feature for live reloading
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s run the application and access both endpoints.
In the output we now see another thread pool is used to serve the requests.
In the following example we rely on the threads from the event loop, so we can revert our code back to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import reactor.core.publisher.Mono;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json">JSON</h3>
<div class="paragraph">
<p>The default content type for controllers is <code>application/json</code> in Micronaut.
Micronaut uses the Jackson library&#8217;s Asynchronous JSON Parsing API to serialize and deserialize JSON string values to Java objects.
We create a new Java class in our application called <code>Message</code> that we want to return as JSON from a new controller method.</p>
</div>
<div class="paragraph">
<p>The <code>Message</code> class is simple and needs to be in the <code>src/main/java/hello</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

public class Message {
    private String text;

    public Message() {}

    public Message(String text) {
        this.text = text;
    }

    public void setText(String text) {
        this.text = text;
    }

    public String getText() {
        return text;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When we use a JDK newer than version 14 we could also use write the <code>Message</code> class using <code>record</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

public record Message(String text) {}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our <code>HelloController</code> class we create a new method that returns a <code>Message</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import reactor.core.publisher.Mono;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the application and when we access <code>/hello/message</code> we get a JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/hello/message
{"text":"Welcome to Micronaut."}
$</pre>
</div>
</div>
<div class="paragraph">
<p>To accept JSON input we can use the <code>@Body</code> annotation in a controller method and Micronaut will transform the JSON string value to a Java object.</p>
</div>
<div class="paragraph">
<p>In our <code>HelloController</code> we add a new method <code>upper</code> that will accept JSON data that is transform to a <code>Message</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import reactor.core.publisher.Mono;

import java.util.Locale;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }

    @Post(uri="/upper")
    public Message upper(@Body Message message) {
        return new Message(message.getText().toUpperCase(Locale.ROOT));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the application and when we POST on <code>/hello/upper</code> we get a JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -d '{"text":"Welcome to Micronaut."}' -H "Content-Type: application/json" http://localhost:8080/hello/upper
{"text":"WELCOME TO MICRONAUT."}
$</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_url_path_variables">URL path variables</h3>
<div class="paragraph">
<p>Until now we used simple endpoints with fixed values.
To use variables in our endpoints we can define the endpoint and enclose the variable in curly braces: <code>{variable}</code>.
If our method argument has the same name as the variable it is automatically bound, otherwise we can use the annotation <code>@PathVariable</code> before the method argument.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add a endpoint with a path variable to our <code>HelloController</code> with the variable <em>name</em>: <code>/{name}</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import reactor.core.publisher.Mono;

import java.util.Locale;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }

    @Post(uri="/upper")
    public Message upper(@Body Message message) {
        return new Message(message.getText().toUpperCase(Locale.ROOT));
    }

    @Get(uri="/{name}")
    public Message greeting(String name) {
        return new Message("Hello " + name + ".");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we re-run our application we can access the endpoint using <code>curl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/hello/JDriven
{"text":"Welcome JDriven."}
$</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_sent_events">Server-sent events</h3>
<div class="paragraph">
<p>Micronaut has also support for Websockets and Server-sent events.
This is useful if we want to serve data that is like a stream without any known end.
In our example <code>HelloController</code> we add some support for server-sent events.</p>
</div>
<div class="paragraph">
<p>We must create a method that returns an <code>Publish&lt;Event&lt;?&gt;&gt;</code> object and Micronaut will turn the method into a server-sent event stream method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import io.micronaut.http.sse.Event;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

import java.time.Duration;
import java.util.Locale;

@Controller("/hello")
public class HelloController {

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.just(
                "Welcome to reactive Micronaut. Running on " +
                        Thread.currentThread().getName());
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }

    @Post(uri="/upper")
    public Message upper(@Body Message message) {
        return new Message(message.getText().toUpperCase(Locale.ROOT));
    }

    @Get(uri="/{name}")
    public Message greeting(String name) {
        return new Message("Hello " + name + ".");
    }

    @Get(uri="/messages", produces="text/event-stream")
    public Publisher&lt;Event&lt;Message&gt;&gt; messages() {
        return Flux.interval(Duration.ofSeconds(1))
                   .map(counter -&gt; Event.of(new Message("Welcome to Micronaut (#" + counter + ").")));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we access the endpoint using <code>curl</code> and we get a stream of messages, where each message is emmited after 1 second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET -H "Accept:text/event-stream" http://localhost:8080/hello/messages
data: {"text":"Welcome to Micronaut (#0)."}

data: {"text":"Welcome to Micronaut (#1)."}

data: {"text":"Welcome to Micronaut (#2)."}

data: {"text":"Welcome to Micronaut (#3)."}

data: {"text":"Welcome to Micronaut (#4)."}

data: {"text":"Welcome to Micronaut (#5)."}
...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependency_injection_2">Dependency injection</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more about <a href="https://docs.micronaut.io/latest/guide/index.html#ioc">Inversion of control</a> to learn about scopes, events, bean qualifies and more.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we look at how we create controllers then for developers that know Spring (Boot) it is very recognizable.
Also, dependency injection has some similarities to how we would define this in our code with Spring (Boot), but Micronaut uses the Javax Injection API.
So we use the <code>@Singleton</code> annotation for example to denote that a class is component that can be injected into other classes.</p>
</div>
<div class="paragraph">
<p>Under the hood a lot of other things happen compared to Spring.
Micronaut will at compile time create classes that make dependency injection work at runtime.
But instead of using reflection at runtime (like Spring does), the extra compiled classes are used and that makes startup time for a Micronaut application much faster.</p>
</div>
<div class="paragraph">
<p>As developers, we don&#8217;t have to know this when we write our code: we can simply use dependency injection using several annotations.</p>
</div>
<div class="paragraph">
<p>In our example Micronaut application we created earlier we add a new class <code>Greeting</code> that we want to inject into a <code>GreetingController</code>.</p>
</div>
<div class="paragraph">
<p>We can create these classes using CLI commands <code>create-bean</code> and <code>create-controller</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-bean Greeting
| Rendered bean to src/main/java/hello/Greeting.java
$ mn create-controller Greeting
| Rendered controller to src/main/java/hello/GreetingController.java
| Rendered test to src/test/java/hello/GreetingControllerTest.java
$</pre>
</div>
</div>
<div class="paragraph">
<p>We add some a simple method to our <code>Greeting</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import jakarta.inject.Singleton;

@Singleton
public class Greeting {
    public Message hello(String name) {
        return new Message("Hello " + name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>GreetingController</code> we inject a <code>Greeting</code> object via the constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/greeting")
public class GreetingController {

    private final Greeting greeting;

    /**
     * With constructor injection we don't need any annotations.
     *
     * @param greeting Greeting object to give back greeting messages.
     */
    public GreetingController(final Greeting greeting) {
        this.greeting = greeting;
    }

    @Get(uri = "/{name}")
    public Message hello(String name) {
        return greeting.hello(name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t use constructor injection we must use the <code>@Inject</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
    @Inject
    private Greeting greeting
...</pre>
</div>
</div>
<div class="paragraph">
<p>If we want to create a component for a class, but we don&#8217;t have access to the source we can use a factory class to create an instance of the component.
For example if we want to create a component from the <code>Greeting</code> class using a factory we would write the following class (and remove <code>@Singleton</code> annotation from the <code>Greeting</code> class):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Factory;

@Factory
public class GreetingFactory {
    @Bean
    public Greeting greeting() {
        return new Greeting();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_2">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To test our application with Micronaut we can use an <code>EmbeddedServer</code> object to start a Micronaut application.
Because the startup time is fast we can start the whole application to test it using an HTTP client.</p>
</div>
<div class="paragraph">
<p>When we created controllers in our sample Micronaut application using the <code>create-controller</code> command also test classes where created for us.</p>
</div>
<div class="paragraph">
<p>For example for <code>GreetingController</code> the class <code>GreetingControllerTest</code> is created in <code>src/test/java/hello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.HttpStatus;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class GreetingControllerTest {

    @Inject
    @Client("/")
    HttpClient client;

    @Test
    public void testIndex() throws Exception {
        assertEquals(HttpStatus.OK, client.toBlocking().exchange("/greeting").status());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@MicronautTest</code> annotation makes sure our Micronaut application is started for the test.
Because the startup time is so fast, we don&#8217;t have to mock the HTTP layers, but we can simply invoke our real endpoints.
This results in much better tests as we can test all aspects of our HTTP requests and the responses.</p>
</div>
<div class="paragraph">
<p>In the test class is an <code>io.micronaut.http.client.HttpClient</code> is injected.
This class is a non-blocking HTTP client that can be used to invoke HTTP requests.
And in the test method the <code>client</code> object is used to invoke the HTTP endpoints of our application.
The client object has several methods to send HTTP requests like <code>exchange</code> or <code>retrieve</code> with different options.
We make the client blocking, so we can assert a response in our tests.</p>
</div>
<div class="paragraph">
<p>To run the tests using Gradle we can execute the <code>test</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew test</pre>
</div>
</div>
<div class="paragraph">
<p>Or run the test directly in our IDE.</p>
</div>
<div class="paragraph">
<p>The <code>GreetingControllerTest</code> test fails now, because the <code>/greeting</code> endpoint cannot be found.
Let&#8217;s fix the test, so we can also test the output of the controller method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class GreetingControllerTest {

    @Inject
    @Client("/")
    HttpClient client;

    @Test
    public void testHello() {
        // when
        HttpResponse&lt;Message&gt; response = client.toBlocking().exchange("/greeting/JDriven", Message.class);

        // then
        assertEquals(HttpStatus.OK, response.status());
        assertEquals("Hello JDriven", response.body().getText());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our <code>HelloController</code> we can also add tests for the different methods we have implemented.</p>
</div>
<div class="paragraph">
<p>In the following sample some methods of <code>HelloController</code> have tests.
We can add more tests for the other methods of <code>HelloController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

@MicronautTest
public class HelloControllerTest {

    @Inject
    @Client("/")
    HttpClient client;

    @Test
    public void testIndex() {
        // when
        HttpResponse&lt;String&gt; response = client.toBlocking().exchange("/hello", String.class);

        // then
        assertEquals(HttpStatus.OK, response.status());
        assertTrue(response.body().startsWith("Welcome to Micronaut."));
    }

    @Test
    public void testReactive() {
        // when
        // Using retrieve returns the body result without response wrapper.
        String response = client.toBlocking().retrieve("/hello/reactive");

        // then
        assertTrue(response.startsWith("Welcome to reactive Micronaut."));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can use JUnit 4/5, Spock and Spek to write tests for our Micronaut application.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The project <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">Micronaut test</a> contains some extensions for JUnit 5 and Spock to make testing a Micronaut application easier.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More info about <a href="https://docs.micronaut.io/latest/guide/index.html#config">Micronaut configuration</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut supports several ways to configure an application.
For developers that use Spring Boot the options to configure an application are very similar:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command line arguments</p>
</li>
<li>
<p>Properties from <code>SPRING_APPLICATION_JSON</code> (for Spring compatibility)</p>
</li>
<li>
<p>Properties from <code>MICRONAUT_APPLICATION_JSON</code></p>
</li>
<li>
<p>Java System Properties</p>
</li>
<li>
<p>OS environment variables</p>
</li>
<li>
<p>Configuration files specified with the system property <code>micronaut.config.files</code> or the environment variable <code>MICRONAUT_CONFIG_FILES</code></p>
</li>
<li>
<p>Enviroment-specific properties from <code>application-{environment}.{extension}</code> (Either <code>.properties</code>, <code>.json</code>, <code>.yml</code> or <code>.groovy</code> property formats supported)</p>
</li>
<li>
<p>Application-specific properties from <code>application.{extension}</code> (Either <code>.properties</code>, <code>.json</code>, <code>.yml</code> or <code>.groovy</code> property formats supported)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example to use a random port when the application starts instead of the default <code>8080</code> we must set the configuration property <code>micronaut.server.port</code> with the value <code>-1</code>.
We can add this property to <code>src/main/resource/application.yml</code>, but could also use the environment variable <code>MICRONAUT_SERVER_PORT=-1</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try to start our application with a random port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ MICRONAUT_SERVER_PORT=-1 ./gradlew run
...
17:14:50.861 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 570ms. Server Running: http://localhost:62796
...</pre>
</div>
</div>
<div class="sect2">
<h3 id="_use_configuration_values">Use configuration values</h3>
<div class="paragraph">
<p>To get a configuration value in our classes we can use the <code>@Value</code> or <code>@Property</code> annotation or use a configuration properties class.
With a configuration properties class we can even validate configuration values.
Micronaut also has <code>@EachProperty/@EachBean</code> annotation to create several instances of configuration properties based on a configuration key and use them to create new components.</p>
</div>
<div class="paragraph">
<p>First we use the <code>@Value</code> annotation to inject a configuration value in our <code>Greeting</code> class.
The argument of the <code>@Value</code> annotation is string with placeholders (<code>${}</code>) to point the configuration property.
A default value can be specified after a colon (<code>:</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.context.annotation.Value;
import jakarta.inject.Singleton;

@Singleton
public class Greeting {

    private final String prefix;

    /**
     * Using constructor injection for the configuration value.
     *
     * @param prefix Prefix for greeting.
     */
    public Greeting(@Value("${greeting.prefix:Hello}") String prefix) {
        this.prefix = prefix;
    }

    public Message hello(String name) {
        return new Message(prefix + " " + name + ".");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run our application and access <code>/greeting/JDriven</code> we get the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/greeting/JDriven
{"text":"Hello JDriven."}
$</pre>
</div>
</div>
<div class="paragraph">
<p>But when we set a value for the configuration property <code>greeting.prefix</code> we get a different response.
Let&#8217;s use an enviroment variable to set the value to <em>Hi</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ GREETING_PREFIX=Hi ./gradlew run
20:43:22.851 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 554ms. Server Running: http://localhost:8080</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/greeting/JDriven
{"text":"Hi JDriven."}
$</pre>
</div>
</div>
<div class="paragraph">
<p>As an exercise we can try to replace the <code>@Value</code> annotation with a configuration properties class.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_client_2">HTTP Client</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more about Micronaut&#8217;s <a href="https://docs.micronaut.io/latest/guide/index.html#httpClient">HTTP Client</a> in the official Micronaut documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides using Netty for the event loop threads on the server side Micronaut also has a HTTP client that uses Netty to support non-blocking HTTP requests.
We can use so-called low-level client or use a declarative client that is generated by Micronaut based on a interface definition.</p>
</div>
<div class="sect2">
<h3 id="_low_level_client">Low-level client</h3>
<div class="paragraph">
<p>In our test classes for example we have alread seen the low-level client that we can use in our application of type <code>HttpClient</code>.
To use it in our application we can inject it into our classes and apply the <code>@Client</code> annotation.
The <code>@Client</code> accepts an argument that can be the complete URL of the external service we want to invoke, it could be a service identifier to be used via a service discovery service or refer to a configuration block.
The <code>HttpClient</code> has the <code>retrieve</code> and <code>exchange</code> methods to get values or pass values via HTTP to an external application.
We can pass or set header values, JSON payloads and more.
<a href="https://docs.micronaut.io/latest/guide/index.html#lowLevelHttpClient">Read the documentation</a> to see what we can do with the <code>HttpClient</code> component.</p>
</div>
<div class="paragraph">
<p>In our example <code>HelloController</code> we will invoke the <code>/greeting</code> endpoint using a <code>HttpClient</code> from the <code>helloReactive</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.http.sse.Event;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

import java.time.Duration;
import java.util.Locale;

@Controller("/hello")
public class HelloController {
    private final HttpClient client;

    public HelloController(@Client("/greeting") HttpClient client) {
        this.client = client;
    }

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.from(client.retrieve("/JDriven"));
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }

    @Post(uri="/upper")
    public Message upper(@Body Message message) {
        return new Message(message.getText().toUpperCase(Locale.ROOT));
    }

    @Get(uri="/{name}")
    public Message greeting(String name) {
        return new Message("Hello " + name + ".");
    }

    @Get(uri="/messages", produces="text/event-stream")
    public Publisher&lt;Event&lt;Message&gt;&gt; messages() {
        return Flux.interval(Duration.ofSeconds(1))
                   .map(counter -&gt; Event.of(new Message("Welcome to Micronaut (#" + counter + ").")));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To debug the requests being sent and received from the HTTP client you can enable tracing logging via your <code>logback.xml</code> file:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;logger name="io.micronaut.http.client" level="TRACE"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>We can start or restart our application and access <code>/hello/reactive</code> to see the output.</p>
</div>
</div>
<div class="sect2">
<h3 id="_declarative_client">Declarative client</h3>
<div class="paragraph">
<p>We can define a declarative HTTP client by putting the <code>@Client</code> annotation on an interface or abstract class.
Micronaut will generate a new class with the implementation for the interface methods to make HTTP requests.
We use annotations like <code>@Get</code>, <code>@Post</code> and others to tell Micronaut what kind of HTTP request we want to make.
This way we can simply use a declarative client and invoke the methods without writing code ourselves to make a HTTP request, send parameters, parse responses.</p>
</div>
<div class="paragraph">
<p>The arguments of the <code>@Client</code> annotation can be the same as when we inject a low-level client with the annotation in our code.</p>
</div>
<div class="paragraph">
<p>In our example Micronaut application we create a declarative client for the <code>/greeting</code> endpoint.
We add an interface <code>GreetingClient</code> with the <code>@Client</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;

@Client("/greeting")
public interface GreetingClient {
    @Get("/{name}")
    Message hello(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we compile the code Micronaut will create an implementation for this interface.
We inject it into our <code>HelloController</code> and use the declarative client in the <code>greeting</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package hello;

import io.micronaut.http.annotation.*;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.http.sse.Event;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

import java.time.Duration;
import java.util.Locale;

@Controller("/hello")
public class HelloController {
    private final HttpClient client;
    private final GreetingClient greetingClient;

    public HelloController(@Client("/greeting") HttpClient client, GreetingClient greetingClient) {
        this.client = client;
        this.greetingClient = greetingClient;
    }

    @Get(uri="/", produces="text/plain")
    public String index() {
        return "Welcome to Micronaut. Running on " +
                    Thread.currentThread().getName();
    }

    @Get(uri="/reactive", produces="text/plain")
    public Mono&lt;String&gt; helloReactive() {
        return Mono.from(client.retrieve("/JDriven"));
    }

    @Get(uri="/message")
    public Message message() {
        return new Message("Welcome to Micronaut.");
    }

    @Post(uri="/upper")
    public Message upper(@Body Message message) {
        return new Message(message.getText().toUpperCase(Locale.ROOT));
    }

    @Get(uri="/{name}")
    public Message greeting(String name) {
        return greetingClient.hello(name);
    }

    @Get(uri="/messages", produces="text/event-stream")
    public Publisher&lt;Event&lt;Message&gt;&gt; messages() {
        return Flux.interval(Duration.ofSeconds(1))
                   .map(counter -&gt; Event.of(new Message("Welcome to Micronaut (#" + counter + ").")));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we restart the application and access <code>/hello/JDriven</code> we get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/hello/JDriven
{"text":"Hello JDriven"}
$</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database">Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Until now, we have seen some core features of Micronaut to create a HTTP REST application.
Most applications also need to access a database (SQL or NoSQL) to store and retrieve data.
Micronaut supports a lot of databases via JDBC/Hibernate, but also has support for Mongo, Redis and other databases.
This support consists mostly of adding the correct components to our application and adding dependencies on the database client libraries to the application.</p>
</div>
<div class="paragraph">
<p>In this workshop we will use the Mongo reactive support in Micronaut.
By using the reactive Mongo client we can make sure the complete chain from controller to backend logic is reacive and non-blocking.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more about <a href="https://docs.micronaut.io/latest/guide/index.html#mongoSupport">Mongo support</a> in Micronaut.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First we create a new application using the <code>create-app</code> command and enable the features <code>mongo-reactive</code>, <code>discovery-consul</code> and <code>management</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app conference --features=mongo-reactive,management,discovery-consul,reactor
| Application created at /Projects/conference
$</pre>
</div>
</div>
<div class="paragraph">
<p>Next we must make sure we have Mongo installed.
The easiest way is using Docker to create a Docker container based on the <code>mongo</code> Docker image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker run --name mongodb --rm -d -p 27017:27017 mongo
...
$</pre>
</div>
</div>
<div class="paragraph">
<p>This starts a Mongo database on port 27017.</p>
</div>
<div class="paragraph">
<p>We change to the directory <code>conference</code>.
First we disable the configuration for Consul (Service Discovery), because we don&#8217;t need it yet in <code>src/main/resources/application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">micronaut:
  application:
    name: conference
#consul:
#  client:
#    defaultZone: ${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}
#    registration:
#      enabled: true
mongodb.uri: mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_mongo_repository">Mongo repository</h3>
<div class="paragraph">
<p>Our data model is for this sample application simple, we want to focus on Micronaut in this workshop.
We need a single class <code>Conference</code> that models a Mongo database document with a name property that describe a conference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package conference;

import org.bson.types.ObjectId;

import java.util.Objects;

public class Conference {
    private ObjectId id;
    private String name;

    public Conference() {
    }

    public Conference(final String name) {
        this.name = name;
    }

    public ObjectId getId() {
        return id;
    }

    public void setId(final ObjectId id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(final String name) {
        this.name = name;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) {return true;}
        if (o == null || getClass() != o.getClass()) {return false;}
        final Conference that = (Conference) o;
        return Objects.equals(id, that.id);
    }

    @Override
    public int hashCode() {
        return Objects.hash(id);
    }

    @Override
    public String toString() {
        return String.format("Conference{id=%s, name='%s'}", id, name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we enabled the Micronaut feature <code>mongo-reactive</code>, the dependency for the Mongo client is also part of our project.</p>
</div>
<div class="paragraph">
<p>Next we create a repository class with some method to fetch and save data from and into Mongo.
To access Mongo Micronaut added a <code>MongoClient</code> object that can be injected into our class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package conference;

import com.mongodb.client.model.Filters;
import com.mongodb.reactivestreams.client.MongoClient;
import com.mongodb.reactivestreams.client.MongoCollection;
import jakarta.inject.Singleton;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

/**
 * Repository to find and save conference data.
 */
@Singleton
public class ConferenceRepository {
    /**
     * Reactive Mongo client.
     */
    private final MongoClient mongoClient;

    public ConferenceRepository(final MongoClient mongoClient) {
        this.mongoClient = mongoClient;
    }

    /**
     * Return all conferences from the collection.
     *
     * @return Flux with found conferences.
     */
    public Flux&lt;Conference&gt; findAll() {
        return Flux.from(getCollection().find());
    }

    /**
     * Save conference in collection if it not already exists.
     *
     * @param conference Conference to save.
     * @return Saved conference.
     */
    public Mono&lt;Conference&gt; save(Conference conference) {
        return findByName(conference.getName())
                .switchIfEmpty(Mono.from(getCollection().insertOne(conference))
                                   .map(insertOneResult -&gt; conference));
    }

    private Mono&lt;Conference&gt; findByName(String name) {
        return Mono.from(getCollection().find(Filters.eq("name", name)).first());
    }

    private MongoCollection&lt;Conference&gt; getCollection() {
        return mongoClient
                .getDatabase("workshop")
                .getCollection("conference", Conference.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our Mongo database is empty, so let&#8217;s add a class that loads data into Mongo when Micronaut starts.
We create a class with the <code>@Singleton</code> annotation to make it a component in Micronaut and implement the interface <code>ApplicationEventListener</code> for the event <code>ServiceStartedEvent</code>.
Micronaut will run the code in this class on application startup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package conference;

import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.context.event.StartupEvent;
import jakarta.inject.Singleton;
import reactor.core.publisher.Flux;

/**
 * Class to load sample conference data on applicaton startup.
 * We listen to the {@link StartupEvent} so we can insert the data on startup.
 */
@Singleton
public class ConferenceLoader implements ApplicationEventListener&lt;StartupEvent&gt; {

    /**
     * Repository to save conference data.
     */
    private final ConferenceRepository conferenceRepository;

    public ConferenceLoader(final ConferenceRepository conferenceRepository) {
        this.conferenceRepository = conferenceRepository;
    }

    /**
     * Load sample data and print saved data.
     *
     * @param event Startup event triggers data loading.
     */
    @Override
    public void onApplicationEvent(final StartupEvent event) {
        Flux.just("Teqnation", "JFall", "JavaLand", "JFokus")
            .map(name -&gt; new Conference(name))
            .flatMap(conferenceRepository::save)
            .subscribe(System.out::println);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conferences_api">Conferences API</h3>
<div class="paragraph">
<p>Next we want to add a controller that returns all conferences in the Mongo database.
The controller can be very simple and should only delegate to the <code>MongoRepository</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package conference;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import reactor.core.publisher.Flux;

@Controller("/conferences")
public class ConferenceController {

    private final ConferenceRepository conferenceRepository;

    public ConferenceController(final ConferenceRepository conferenceRepository) {
        this.conferenceRepository = conferenceRepository;
    }

    @Get("/")
    public Flux&lt;Conference&gt; index() {
        return conferenceRepository.findAll();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring">Monitoring</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To learn about <a href="https://docs.micronaut.io/latest/guide/index.html#management">built-in management and monitoring</a> for Micronaut read the documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can monitor our Micronaut applications like Spring Boot applications that use actuator.
For a Micronaut application it means we need to enable the feature <em>management</em> in our application.
This will add a set of endpoints, like <code>/info</code>, <code>/health</code>, to our application which provide information about the internals of the application.
Most endpoints must be enabled via the application configuration.
Only the <code>/health</code> endpoint already returns a result for an application, although with some extra configuration we can add more information about our application&#8217;s health.</p>
</div>
<div class="sect2">
<h3 id="_health">Health</h3>
<div class="paragraph">
<p>Let&#8217;s start our conference application and invoke the <code>/health</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/health
{"status":"UP"}
$</pre>
</div>
</div>
<div class="paragraph">
<p>So if our application is running and the Mongo database can be reached we get back a JSON response with the status field with value <code>UP</code>.
Let&#8217;s stop our Mongo database and access the <code>/health</code> endpoint again. After a timeout that is passed for trying to access the database we get a <code>DOWN</code> status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/health
{"status":"DOWN"}
$</pre>
</div>
</div>
<div class="paragraph">
<p>To get more detailed information from the health endpoint we can add to the application configuration the property <code>endpoints.health.sensitive</code> with value <code>false</code> and <code>endpoints.health.details-visible</code> with value <code>ANONYMOUS</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">micronaut:
  application:
    name: conference
#consul:
#  client:
#    defaultZone: ${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}
#    registration:
#      enabled: true
mongodb.uri: mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}
endpoints:
  health:
    sensitive: false
    details-visible: ANONYMOUS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we start our conference service and access the health endpoint (and apply some JSON pretty printing) we see much more information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/health | jq
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   603  100   603    0     0  26012      0 --:--:-- --:--:-- --:--:-- 26217
{
    "details": {
        "compositeDiscoveryClient()": {
            "name": "conference",
            "status": "UP"
        },
        "diskSpace": {
            "details": {
                "free": 35236192256,
                "threshold": 10485760,
                "total": 499963174912
            },
            "name": "conference",
            "status": "UP"
        },
        "mongodb": {
            "details": {
                "mongodb (Primary)": {
                    "details": {
                        "version": "5.0.3"
                    },
                    "name": "conference",
                    "status": "UP"
                }
            },
            "name": "conference",
            "status": "UP"
        },
        "service": {
            "name": "conference",
            "status": "UP"
        }
    },
    "name": "conference",
    "status": "UP"
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_info">Info</h3>
<div class="paragraph">
<p>To get data from the <code>/info</code> endpoint we must first change the configuration to enable the endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">micronaut:
  application:
    name: conference
#consul:
#  client:
#    defaultZone: ${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}
#    registration:
#      enabled: true
mongodb.uri: mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}
endpoints:
  health:
    sensitive: false
    details-visible: ANONYMOUS
  info:
    sensitive: false
    enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To provide data for the info endpoint we can write a component that implements the <code>InfoSource</code> interface.
Micronaut will look for components that implement this interface, get the data for each component and aggregate it into information for the <code>/info</code> endpoint.</p>
</div>
<div class="paragraph">
<p>There is already a component that will look for configuration properties that have the key <code>info</code>, so that is an easy way to add information to the endpoint.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add some extra info in our configuration file <code>application.yml</code> with the key <code>info</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">micronaut:
  application:
    name: conference
#consul:
#  client:
#    defaultZone: ${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}
#    registration:
#      enabled: true
mongodb.uri: mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}
endpoints:
  health:
    sensitive: false
    details-visible: ANONYMOUS
  info:
    sensitive: false
    enabled: true
info:
  workshop:
    name: Micronaut
    location: Nieuwegein</code></pre>
</div>
</div>
<div class="paragraph">
<p>We (re)start our service and query for the <code>/info</code> URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/info
{"workshop":{"name":"Micronaut","location":"Nieuwegein"}}
$</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of adding configuration properties we can also write our own component that implements <code>InfoSource</code>.
We will write a class that will return the Java version of the runtime that our conference application runs on.
We create a new class <code>JavaVersionInfo</code> with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package conference;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.PropertySource;
import io.micronaut.management.endpoint.info.InfoEndpoint;
import io.micronaut.management.endpoint.info.InfoSource;
import jakarta.inject.Singleton;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

import java.util.Collections;

@Singleton
@Requires(beans = InfoEndpoint.class) // Conditionally load component
@Requires(property = "endpoints.info.config.enabled", notEquals = "false")
public class JavaVersionInfo implements InfoSource {
    @Override
    public Publisher&lt;PropertySource&gt; getSource() {
        return Flux.just(
                PropertySource.of(
                        "info", Collections.singletonMap(
                                "jvmVersion", System.getProperty("java.version"))));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use the <code>@Requires</code> annotation to make this a conditional bean. This means the bean will only be made available when all condition requirements are met. See <a href="https://docs.micronaut.io/latest/guide/index.html#conditionalBeans">condition beans</a> in the Micronaut guide for more options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now when we access <code>/info</code> we also see the JVM version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/info
{"jvm-version":"17","workshop":{"name":"Micronaut","location":"Nieuwegein"}}
$</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_discovery">Service discovery</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more about <a href="https://docs.micronaut.io/latest/guide/index.html#serviceDiscovery">Service Discovery</a> support in Micronaut to learn about supported services.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Usually a microservice is part of a bigger landscape of microservices.
If we want to access a microservice we must know its address and port, but that is not very flexible and scalable.
What we want is to use a Service Discovery service, where our Micronaut application can be registered with a logical name.
Other applications can then use that logical name to make HTTP requests and the application doesn&#8217;t need to know the address or port number.</p>
</div>
<div class="paragraph">
<p>In this workshop we use <a href="https://www.consul.io/">Consul</a> as a Service Discovery service.
Micronaut supports Consul, but also Euraka, Kubernetes, AWS Route.</p>
</div>
<div class="sect2">
<h3 id="_consul">Consul</h3>
<div class="paragraph">
<p>To install Consul we use a Docker image for Consul and create a container from it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker run --name consul --rm -p 8500:8500 -d consul
...
$</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conference_service">Conference service</h3>
<div class="paragraph">
<p>To register our conference application with Consul we must re-enable the default configuration for Consul again in <code>src/main/resources/application.yml</code>.
We also configure a default server port value of <code>-1</code> in the configuration.
This means that we can start multiple instances of our Micronaut conferences application without any conflicting port usages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>micronaut:
  application:
    name: conference
  server:
    port: -1
consul:
  client:
    defaultZone: ${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}
    registration:
      enabled: true
mongodb.uri: mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}
endpoints:
  health:
    sensitive: false
    details-visible: ANONYMOUS
  info:
    sensitive: false
    enabled: true
info:
  workshop:
    name: Micronaut
    location: Nieuwegein</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start multiple instances of the conferences application and then open <a href="http://localhost:8500/" class="bare">http://localhost:8500/</a> in our web browser.
This is the UI of Consul, and it shows all applications that are registered with Consul.
Our Micronaut application is registered under the name <code>conference</code>.</p>
</div>
<div class="paragraph">
<p>When we stop one or more instances, the Consul UI will be updated and only show what is really running.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gateway">Gateway</h3>
<div class="paragraph">
<p>It is nice that we can register one or multiple instances of our conference application, but it gets interesting when we add a new application to the mix that will make HTTP requests to those conferences applications, using client side load balancing.
Therefore, we create a new Micronaut application: <em>gateway</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app gateway --features=management,discovery-consul,reactor
| Application created at /Projects/gateway
$</pre>
</div>
</div>
<div class="paragraph">
<p>This application will expose an endpoint at <code>/gateway</code> that will return all conference names fetched from the conference application.</p>
</div>
<div class="paragraph">
<p>Our application will invoke the <code>/conferences</code> endpoint of our conferences application and that returns a list of <code>Conference</code> objects.
In the gateway application we must add a new class <code>Conference</code> that will be used as mapping for the JSON output of the conference application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

public class Conference {
    private String name;

    public Conference() {
    }

    public Conference(final String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setName(final String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return String.format("Conference{name='%s'}", name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next is our declarative client for accessing the conference application using HTTP.
Instead of defining the URL for the conference application we specify an <code>id</code> argument that has the value of the name that is used to register the conference applications with Consul.
We define an interface with the operations we want to invoke to get the list of conferences, because later we will see how we can use a fallback implementation if there are network issues for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import reactor.core.publisher.Flux;

/**
 * Get all conference data.
 */
public interface  ConferenceOperations {
    /**
     * Return all conference data.
     *
     * @return Flux with conference data.
     */
    Flux&lt;Conference&gt; all();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import reactor.core.publisher.Flux;

@Client(id = "conference")
public interface ConferenceClient extends ConferenceOperations {
    @Get("/conferences")
    @Override
    Flux&lt;Conference&gt; all();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can inject the declarative client in a controller with a method that will get all conferences and then returns all names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import reactor.core.publisher.Flux;

@Controller("/gateway")
public class GatewayController {
    private final ConferenceOperations conferenceOperations;

    public GatewayController(final ConferenceOperations conferenceOperations) {
        this.conferenceOperations = conferenceOperations;
    }

    @Get("/")
    public Flux&lt;String&gt; index() {
        return conferenceOperations.all().map(Conference::getName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our gateway application is ready, and we can start it for example with Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew run
09:11:01.519 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 1174ms. Server Running: http://localhost:8080
$</pre>
</div>
</div>
<div class="paragraph">
<p>Also, we need to start one or more conference applications, and then we can invoke the <code>/gateway</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/gateway
[Teqnation,JFall,JFokus,JavaLand]
$</pre>
</div>
</div>
<div class="paragraph">
<p>Our <code>ConferenceClient</code> uses a round-robin load balancing to choose between the different running conference applications.
We can also stop all applications, and then we get an error when we access <code>/gateway</code>.
But if we restart one or more of the conference applications and then access <code>/gateway</code> again we will get an answer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retry">Retry</h3>
<div class="paragraph">
<p>Because network connections can be closed and reopened shortly after we can also use the <code>@Retryable</code> annotation in Micronaut.
With this annotation a call is retried 3 times by default, but we can change this if we want.
We can also set the timeout between retries.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add the <code>@Retryable</code> annotation to our <code>ConferenceClient</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.retry.annotation.Retryable;
import reactor.core.publisher.Flux;

@Retryable(attempts = "4", delay = "500ms")
@Client(id = "conference")
public interface ConferenceClient extends ConferenceOperations {
    @Get("/conferences")
    @Override
    Flux&lt;Conference&gt; all();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of <code>@Retryable</code> we could also use <code>@CircuitBreaker</code> which would retry a call, but closes the circuit for a specific time before retrying again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This time we can restart the gateway application and stop the conference application when we access <code>/gateway</code>.
If we bring up the conference application before the retry timeout has occurred we still get an answer from our initial request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fallback">Fallback</h3>
<div class="paragraph">
<p>Instead of getting an error when one of the backend microservices is down (the conference application in our workshop), we could provide a fallback implementation.
The fallback implementation is used when even after retrying the backend service is no longer available.</p>
</div>
<div class="paragraph">
<p>In our gateway application we can create a fallback for the <code>ConferenceClient</code>.
We implement the <code>ConferenceOperations</code> interface and add the annotation <code>@Fallback</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import io.micronaut.retry.annotation.Fallback;
import reactor.core.publisher.Flux;

@Fallback
public class ConferenceFallback implements ConferenceOperations {
    @Override
    public Flux&lt;Conference&gt; all() {
        return Flux.just(new Conference("Workshop Micronaut"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we must add the <code>@Recoverable</code> annotation on our client to tell Micronaut to use the fallback implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package gateway;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.retry.annotation.Recoverable;
import io.micronaut.retry.annotation.Retryable;
import reactor.core.publisher.Flux;

@Retryable(attempts = "4", delay = "500ms")
@Recoverable(api = ConferenceOperations.class)
@Client(id = "conference")
public interface ConferenceClient extends ConferenceOperations {
    @Get("/conferences")
    @Override
    Flux&lt;Conference&gt; all();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can start our gateway application, but we don&#8217;t start the conference application, so the fallback implementation should be called.
And when we access <code>/gateway</code> we get indeed our fallback implementation result after the retry timeout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/gateway
[Workshop Micronaut]
$</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To learn about other cloud native features in Micronaut read <a href="https://docs.micronaut.io/latest/guide/index.html#cloud">the Micronaut guide</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_functions">Serverless functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://guides.micronaut.io/micronaut-function-aws-lambda/guide/index.html">Micronaut guide</a> contains a description and steps on how to develop a serverless function. Check also the part about SAM CLI in the guide, which allows us to test the serverless function locally.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graalvm_support">GraalVM support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut has a low resource usage and starts up fast. Combine this with GraalVM and the Micronaut support for GraalVM and you can write native applications using Java. Follow the <a href="http://guides.micronaut.io/micronaut-creating-first-graal-app/guide/index.html">Micronaut guide on GraalVM</a> to build a Java application that runs as a native executable.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-11-12 21:23:03 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>